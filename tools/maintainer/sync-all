#!/bin/sh -xv

HOSTS="
halko.pc.infrahip.net
netherstorm.infrahip.net
terokkar.infrahip.net
shadowmoon.infrahip.net
stonebreaker.infrahip.net
hellfire.infrahip.net
zangarmash.infrahip.net
blacktemple.infrahip.net
"

COMMANDS="
cd /tmp;
sudo rm -rf trunk;
rm hipl.tar.gz;
wget http://hipl.hiit.fi/hipl/hipl.tar.gz &&
tar xvzf hipl.tar.gz &&
cd trunk &&
autoreconf --install &&
./configure &&
make bin syncrepo"

#set -e

# unconfigured:
# ubuntu lucid 32-bit allerian
# ubuntu lucid 64-bit cenarion 64-bit
# ubuntu lucid 64-bit garadar
#
# configured:
# Ubuntu lucid 32-bit terokkar.infrahip.net
# Ubuntu lucid 64-bit halko.pc.infrahip.net (real host)
# f12-i386            netherstorm.infrahip.net
# F12-x86_64          shadowmoon.infrahip.net
# CentOS-5.4 i386     hellfire.infrahip.net
# CentOS-5.4 x86_64   zangarmash.infrahip.net
# fc11-i386           blacktemple
# fc11-x86_64         stonebreaker
#
# disabled:
# F10-x86_64          nagrand.infrahip.net
# FC11-i386           hipserver (real host)

if test $# != 0
then
    HOSTS="$@"
fi

echo "--- Pinging all hosts ---"

for HOST in $HOSTS
do
    ping -c 2 $HOST
done

echo "--- Executing command on each host ---"

time for HOST in $HOSTS
do
    echo "--- Host: $HOST ---"
    ping -c 2 $HOST
    if test $? = 0
    then
        ssh $HOST $COMMANDS
    else
        echo "Not responding, skipping"
    fi
done
